<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boutique Premium</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Styles pour les cat√©gories */
        .categories-section {
            margin-bottom: 40px;
        }

        .category-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .category-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 15px 30px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .category-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.1);
        }

        .category-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .filter-info {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 20px;
            font-size: 16px;
        }

        .show-all-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 16px;
            padding: 15px 30px;
        }

        .show-all-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .show-all-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .category-buttons {
                gap: 10px;
            }

            .category-btn {
                padding: 12px 20px;
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .category-btn {
                padding: 10px 15px;
                font-size: 14px;
                width: calc(50% - 5px);
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header avec logo -->
    <header class="header">
        <div class="header-content">
            <h1 class="header-title" data-site-title>Boutique Premium</h1>
        </div>
    </header>

    <!-- Effet de flou -->
    <div class="blur-background"></div>

    <!-- Contenu -->
    <div class="container">
        <!-- Section des cat√©gories -->
        <div class="categories-section">
            <h2 style="text-align: center; color: white; margin-bottom: 20px; font-size: 24px; text-transform: uppercase; letter-spacing: 2px;">
                Nos Produits
            </h2>
            <div class="category-buttons">
                <button class="category-btn show-all-btn active" onclick="filterProducts('all')">
                    üõçÔ∏è Tous les produits
                </button>
                <button class="category-btn" onclick="filterProducts('categories')">
                    üè∑Ô∏è Cat√©gories
                </button>
                <button class="category-btn" onclick="filterProducts('farm')">
                    üå± Farm
                </button>
            </div>
            
            <div class="filter-info" id="filterInfo" style="display: none;">
                <!-- Info sur le filtre actif -->
            </div>
        </div>

        <!-- Grille des produits -->
        <div class="products-grid" id="productsGrid">
            <!-- Les produits seront affich√©s ici -->
        </div>
    </div>

    <!-- Navigation du bas -->
    <nav class="bottom-nav">
        <div class="ios-bar"></div>
        <div class="nav-container">
            <a href="index.html" class="nav-item active">
                <span class="nav-icon">üè†</span>
                <span class="nav-label">Menu</span>
            </a>
            <a href="infos.html" class="nav-item">
                <span class="nav-icon">‚ÑπÔ∏è</span>
                <span class="nav-label">Infos</span>
            </a>
            <a href="canal.html" class="nav-item">
                <span class="nav-icon">üì°</span>
                <span class="nav-label">Canal</span>
            </a>
            <a href="contact.html" class="nav-item">
                <span class="nav-icon">‚úâÔ∏è</span>
                <span class="nav-label">Contact</span>
            </a>
        </div>
    </nav>

    <script src="app.js"></script>
    <script src="site-config.js"></script>
    <script>
        // Produits avec leurs cat√©gories
        const products = [
            // Cat√©gories
            {
                id: 'caliplates',
                name: 'CALIPLATES',
                subtitle: 'Plusieurs vari√©t√©s',
                image: 'https://images.unsplash.com/photo-1597075388115-e59de916bdcc?w=400&h=250&fit=crop&q=80',
                category: 'categories'
            },
            {
                id: 'sahas-terps',
                name: 'Sahas terps',
                subtitle: 'Plusieurs vari√©t√©s',
                image: 'https://images.unsplash.com/photo-1597848212624-a19eb35e2651?w=400&h=250&fit=crop&q=80',
                category: 'categories'
            },
            {
                id: 'static-sift-us',
                name: 'STATIC SIFT US',
                subtitle: 'Plusieurs vari√©t√©s',
                image: 'https://images.unsplash.com/photo-1582657233895-0f37a3f150c0?w=400&h=250&fit=crop&q=80',
                category: 'categories'
            },
            {
                id: 'hash-marocain',
                name: 'HASH MAROCAIN',
                subtitle: 'Plusieurs vari√©t√©s',
                image: 'https://images.unsplash.com/photo-1536819114556-1e10f967fb61?w=400&h=250&fit=crop&q=80',
                category: 'categories'
            },
            {
                id: 'hash-afghan',
                name: 'HASH AFGHAN',
                subtitle: 'Plusieurs vari√©t√©s',
                image: 'https://images.unsplash.com/photo-1526575482212-b927f0915d55?w=400&h=250&fit=crop&q=80',
                category: 'categories'
            },
            // Farm
            {
                id: 'trim-cbd',
                name: 'TRIM CBD',
                subtitle: 'Plusieurs vari√©t√©s',
                image: 'https://images.unsplash.com/photo-1556928045-16f7f50be0f3?w=400&h=250&fit=crop&q=80',
                category: 'farm'
            },
            {
                id: 'fleurs-hhcp',
                name: 'FLEURS HHCP',
                subtitle: 'Plusieurs vari√©t√©s',
                image: 'https://images.unsplash.com/photo-1603909223200-29690d683e64?w=400&h=250&fit=crop&q=80',
                category: 'farm'
            },
            {
                id: 'vapes-hhcp',
                name: 'VAPES HHCP',
                subtitle: 'Plusieurs vari√©t√©s',
                image: 'https://images.unsplash.com/photo-1546435770-a3e426bf472b?w=400&h=250&fit=crop&q=80',
                category: 'farm'
            },
            {
                id: 'thcp',
                name: 'THCP',
                subtitle: 'Plusieurs vari√©t√©s',
                image: 'https://images.unsplash.com/photo-1616093619471-3959b0581d60?w=400&h=250&fit=crop&q=80',
                category: 'farm'
            }
        ];

        let currentFilter = 'all';

        // Fonction pour filtrer les produits
        function filterProducts(category) {
            currentFilter = category;
            
            // Mettre √† jour les boutons actifs
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Trouver et activer le bon bouton
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // Si appel√© sans event (au chargement), activer le bouton "Tout afficher"
                document.querySelector('.show-all-btn').classList.add('active');
            }
            
            // Mettre √† jour l'info de filtre
            const filterInfo = document.getElementById('filterInfo');
            if (category === 'all') {
                filterInfo.style.display = 'none';
            } else {
                filterInfo.style.display = 'block';
                filterInfo.textContent = `Filtrage actif : ${category === 'categories' ? 'Cat√©gories' : 'Farm'}`;
            }
            
            // Afficher les produits filtr√©s
            displayProducts();
        }

        // Fonction pour afficher les produits
        function displayProducts() {
            const grid = document.getElementById('productsGrid');
            const filteredProducts = currentFilter === 'all' 
                ? products 
                : products.filter(p => p.category === currentFilter);
            
            console.log('Affichage des produits:', filteredProducts.length, 'produits');
            
            if (filteredProducts.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: white; padding: 40px;">Aucun produit disponible</p>';
                return;
            }
            
            grid.innerHTML = filteredProducts.map(product => `
                <a href="product-detail.html?product=${product.id}" class="product-card">
                    <div class="product-image">
                        <img src="${product.image}" alt="${product.name}">
                    </div>
                    <div class="product-info">
                        <h2 class="product-title">${product.name}</h2>
                        <p class="product-subtitle">${product.subtitle}</p>
                    </div>
                </a>
            `).join('');
        }

        // Charger les produits depuis MongoDB
        async function loadProductsFromDB() {
            try {
                const response = await fetch('/api/products');
                
                if (!response.ok) {
                    throw new Error('Erreur lors du chargement des produits');
                }
                
                const dbProducts = await response.json();
                
                if (dbProducts && dbProducts.length > 0) {
                    // Remplacer les produits statiques par ceux de la DB
                    products.length = 0;
                    dbProducts.forEach(product => {
                        products.push({
                            id: product._id || product.slug || product.name.toLowerCase().replace(/\s+/g, '-'),
                            name: product.name,
                            subtitle: product.description || 'Plusieurs vari√©t√©s',
                            image: product.image,
                            category: product.category || 'categories'
                        });
                    });
                    displayProducts();
                    console.log('Produits charg√©s depuis MongoDB:', products.length);
                } else {
                    console.log('Aucun produit dans la base de donn√©es, utilisation des produits par d√©faut');
                }
            } catch (error) {
                console.error('Erreur lors du chargement des produits:', error);
                // Afficher un message d'erreur discret
                const grid = document.getElementById('productsGrid');
                if (products.length === 0) {
                    grid.innerHTML = '<p style="text-align: center; color: white; padding: 40px;">Chargement des produits...</p>';
                }
            }
        }

        // Initialiser l'affichage
        document.addEventListener('DOMContentLoaded', () => {
            // Afficher tous les produits par d√©faut
            displayProducts();
            
            // Charger les produits depuis MongoDB
            loadProductsFromDB();
            
            // Marquer le bouton "Tout afficher" comme actif par d√©faut
            document.querySelector('.show-all-btn').classList.add('active');
        });
    </script>
</body>
</html>